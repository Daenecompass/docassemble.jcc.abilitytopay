modules:
  - docassemble.base.util
  - .a2p
---
features:
  bootstrap theme: style.css
  progress bar: True
  javascript: a2p.js
---
metadata:
  title: Ability to Pay
---
template: help_tip
content: | 
  <span title="${help_tip_text}" data-toggle="tooltip">(?)</span>
---
code: |
   help_tip_text = "This is text that shows in a tooltip."
---
field: before_you_start
question: |
  Before You Start
subquestion: |
  *This online system is an optional way to request a fine reduction due to financial need. If you want to contest your ticket, see the [instructions on your ticket](http://www.courts.ca.gov/selfhelp-traffic.htm) for more information on contesting your ticket.*
  ${help_tip}

  Use this tool to:

  * Request a reduction in your traffic fine based on financial need
  * Request to pay in installments (set up payment plan)
  * Request Community Service 
  * Request more time to pay your ticket
---
question: |
  Find Citation
fields:
- "What county did you get the citation in?": county
  choices:
  - "Alameda": Alameda
  - "Alpine": Alpine
  - "Amador": Amador
  - "Butte": Butte
  - "Calaveras": Calaveras
  - "Colusa": Colusa
  - "Contra Costa": Contra Costa
  - "Del Norte": Del Norte
  - "El Dorado": El Dorado
  - "Fresno": Fresno
  - "Glenn": Glenn
  - "Humboldt": Humboldt
  - "Imperial": Imperial
  - "Inyo": Inyo
  - "Kern": Kern
  - "Kings": Kings
  - "Lake": Lake
  - "Lassen": Lassen
  - "Los Angeles": Los Angeles
  - "Madera": Madera
  - "Marin": Marin
  - "Mariposa": Mariposa
  - "Mendocino": Mendocino
  - "Merced": Merced
  - "Modoc": Modoc
  - "Mono": Mono
  - "Monterey": Monterey
  - "Napa": Napa
  - "Nevada": Nevada
  - "Orange": Orange
  - "Placer": Placer
  - "Plumas": Plumas
  - "Riverside": Riverside
  - "Sacramento": Sacramento
  - "San Benito": San Benito
  - "San Bernardino": San Bernardino
  - "San Diego": San Diego
  - "San Francisco": San Francisco
  - "San Joaquin": San Joaquin
  - "San Luis Obispo": San Luis Obispo
  - "San Mateo": San Mateo
  - "Santa Barbara": Santa Barbara
  - "Santa Clara": Santa Clara
  - "Santa Cruz": Santa Cruz
  - "Shasta": Shasta
  - "Sierra": Sierra
  - "Siskiyou": Siskiyou
  - "Solano": Solano
  - "Sonoma": Sonoma
  - "Stanislaus": Stanislaus
  - "Sutter": Sutter
  - "Tehama": Tehama
  - "Trinity": Trinity
  - "Tulare": Tulare
  - "Tuolumne": Tuolumne
  - "Ventura": Ventura
  - "Yolo": Yolo
  - "Yuba": Yuba
- "What's the citation number?": citation_number
---
code: |
  citation_data = fetch_citation_data(citation_number, county)
  if citation_data['success']:
      data = citation_data['data']
      violation_date = date_from_iso8601(data['charges'][0]['violationDate'])
      total_due = format_money(data['totalDueAmt'])
      first_name = data['firstName']
      last_name = data['lastName']
  else:
      log('Sorry, we could not find that citation.', 'danger')
      reconsider('county')
---
question: |
  Request to Court
fields: 
- html: |
   <div class="info-card">${citation_number}<dl><dt>Name</dt><dd>${first_name} ${last_name}</dd><dt>Citation Number</dt><dd>${citation_number}</dd><dt>County</dt><dd>${county}</dd><dt>Violation Date</dt><dd>${violation_date}</dd><dt>Total Due</dt><dd>${total_due}</dd></dl></div>
- "Would you like to request a reduction in your fine for this citation?": verify_citation
  input type: radio
  choices:
  - "Yes": correct_citation
  - "That's not the right citation!": name_lookup
- What is your first name?: first_name
  show if:
    variable: verify_citation
    is: name_lookup
- What is your last name?: last_name
  show if:
    variable: verify_citation
    is: name_lookup
- What's your date of birth?: dob
  datatype: date
  show if:
    variable: verify_citation
    is: name_lookup
- What is your Driver's License Number?: license_number
  datatype: number
  show if:
    variable: verify_citation
    is: name_lookup
---
code: |
   if verify_citation == "name_lookup":
       response = fetch_case_data(first_name, last_name, dob, citation_number, 'Santa Clara')
       if response['success']:
            case_lookup_results = []
            for case in response['data']:
                violation_date = date_from_iso8601(case['violationDate'])
                total_due = format_money(case['totalDueAmt'])
                case_lookup_results.append({ case['citationNumber']: "{citationNumber}<dl><dt>Name</dt><dd>{name}</dd><dt>Citation Number</dt><dd>{citationNumber}</dd><dt>County</dt><dd>{county}</dd><dt>Violation Date</dt><dd>{violationDate}</dd><dt>Total Due</dt><dd>{totalDue}</dd></dl>".format(name=case['firstName'] + " " + case['lastName'], county=county, citationNumber=case['citationNumber'], violationDate=violation_date, totalDue=total_due) })
       else:
          log('Sorry, we could not find that citation.', 'danger')
          reconsider('county')
            
---
question: Which of the following is your citation?
fields:
- "Select the citation from the list below.": selected_case
  input type: radio
  code: |
    case_lookup_results
---
field: how_work
question: |
  How this works
subquestion: |
  *We are going to walk through a few questions to help the Court better understand your need for a reduction.*

  Even though this is an online process, a judge/court official  will still review your request the same way they would if you came to court in person.
---
question: |
  Public Benefits
fields:
- 'Are you currently receiving any benefits? If you don''t see the public benefit you are currently enrolled in, click "Other"': benefits
  datatype: checkboxes
  choices:
  - "CalFresh (Food Stamps)": cal_fresh
  - Medi-Cal: medi_cal
  - "Supplemental Security Income (SSI)": ssi
  - "State Supplemental Payment (SSP)": ssp
  - "County Relief/General Assistance": cr_ga
  - "In Home Supportive Services (IHSS)": ihss
  - "California Work Opportunity and Responsibility to Kids Act (Cal WORKS)": cal_works
  - "Tribal Temporary Assistance for Needy Families (TANF)": tanf
  - "Cash Assistance Program for Aged, Blind or Disabled Legal Immigrants (CAPI)": capi
  - Other: other
---
question: |
  CalFresh Detail
subquestion: |
  *You said you receive Calfresh, can you please upload a picture of your CalFresh card?*
fields:
- Calfrash Card: calfresh_card
  datatype: file
---
question: |
  Current Income
subquestion: |
  *How much money do you earn (take-home pay) or get from other sources(including income received in your family from a spouse or live-in romantic partner)?* 

  Answer the best you can.
fields:
- Frequency of Income: frequency
  choices:
  - "Once a year": annual
  - "Once a month": monthly
  - "Twice a month": twice_monthly
  - "Every two weeks": two_weeks
  - "Every week": weekly
- Amount of Income: income
  datatype: currency
---
question: |
  Household Details
fields:
- "How many people live in your household?": residents
  datatype: number
---
question: |
  Monthly Expenses
subquestion: |
  *Help us understand your monthly expenses.*
fields:
- Monthly Rent: monthly_rent
  datatype: currency
- Mortgage: mortgage
  datatype: currency
- Utilities: utilities
  datatype: currency
- Phone Bill: phone_bill
  datatype: currency
- Food (Groceries & Restaurants): food
  datatype: currency
- Insurance: insurance
  datatype: currency
- Clothing: clothing
  datatype: currency
- Child/Spousal Support: child_spousal_support
  datatype: currency
- Transportation (Gas, Car Payments, Transit): transportation
  datatype: currency
---
question: |
  Additional Requests
fields:
- "A court official will review your request. Whether or not your request for a reduction is granted, would you like to add any of the following requests to the current or reduced amount?": additional_requests
  datatype: checkboxes
  choices:
  - "Payment Plan (default at $25/month)": payment_plan
  - "Community Service (for the current or reduced amount)": community_service
  - "Extension (more Time to Pay)": extension
---
question: |
  Make your Plea
subquestion: |
  *In order to proceed with your request for a reduction, you need to admit responsibility for the charge for which you received a ticket and plead no contest.*

  To plead no contest, please waive the following: 

  * To be represented by an attorney employed by you;
  * To have a speedy and public trial in front of a judge;
  * To testify, to present evidence, and to use court orders without cost to compel the attendance of witnesses and the production of evidence on your behalf;
  * To have the witnesses against you testify under oath in court, and to question such witnesses;
  * To remain silent and not testify and not incriminate yourself.
  
  Continue if you have read, understand and waive the rights above and agree to plead “No Contest”.

  **Any conviction will be reported to the Department of Motor Vehicles (DMV). This is the case whether you pay in full or not.**
progress: 75
fields:
- "I have read, understand and waive the rights above and agree to plead No Contest": agree_no_contest
  datatype: yesno
---
question: |
  Optional Questions
fields:
- "Was this tool helpful in addressing this traffic matter?": tool_helpful
- "Would you have been able to go to court in person?": able_in_person
  datatype: yesnoradio
- "Why would getting to court have been difficult for you?": why_difficult
  input type: checkboxes
  show if:
    variable: able_in_person
    is: false
  choices:
    - "Physical Disability": why_difficult
    - "Can't take time off work": why_difficult
    - "Childcare": childcare
---
question: |
  Final Step
subquestion: |
  *The information you have provided will not be sent to the court until you hit submit. You must also promise what you have submitted is true.*
progress: 95
fields:
- Signature: signature
- Date: signature_date
---
code: |
  submit_to_a2p = submit_interview(all_variables())
---
mandatory: True
code: |
  before_you_start
  county
  citation_number
  verify_citation
  if verify_citation == "name_lookup":
    selected_case
    case_lookup_results
  how_work
  benefits
  if benefits["cal_fresh"]:
    calfresh_card
  income
  frequency
  residents
  monthly_rent
  mortgage
  utilities
  phone_bill
  food
  insurance
  clothing
  child_spousal_support
  transportation
  additional_requests
  agree_no_contest
  tool_helpful
  able_in_person
  signature
  submit_to_a2p
  all_done
---
question: |
  Thank you!
subquestion: |
  *Expect a response from the court in XX business days. If you don't get a notification from your court please contact XXXXX@XXXX.gov.*
sets: all_done
---
question: |
  Goodbye!
sets: do_exit

